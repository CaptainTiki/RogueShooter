extends Panel
class_name GunBenchStatsPanel

@export var gun_bench : GunBench

@onready var dmg_label: Label = $GridContainer/Dmg_label
@onready var fire_rate_label: Label = $GridContainer/FireRate_label
@onready var mag_size_label: Label = $GridContainer/MagSize_label
@onready var reload_time_label: Label = $GridContainer/ReloadTime_label
@onready var accuracy_label: Label = $GridContainer/Accuracy_label
@onready var recoil_label: Label = $GridContainer/Recoil_label
@onready var dps_label: Label = $GridContainer/DPS_label

var damage : float = 0
var fire_rate : float = 0
var mag_size : float = 0
var reload_time : float = 0
var accuracy : float = 0
var recoil : float = 0
var spread : float = 0

func _ready() -> void:
	gun_bench.PartChanged.connect(_on_part_changed)

func _on_part_changed(_part : GunPartDef, build : Dictionary[GunPartDef.Type, GunPartDef]) -> void:
	calculate_stats(build)
	update_UI()

func calculate_stats(build : Dictionary[GunPartDef.Type, GunPartDef]) -> void:
	var barrel : BarrelDef = build[GunPartDef.Type.BARREL] as BarrelDef
	var chamber : ChamberDef = build[GunPartDef.Type.CHAMBER] as ChamberDef
	var mag : MagDef = build[GunPartDef.Type.MAG] as MagDef
	var frame : FrameDef = build[GunPartDef.Type.FRAME] as FrameDef
	var optics : OpticsDef = build[GunPartDef.Type.OPTICS] as OpticsDef
	
	damage = chamber.damage
	fire_rate = frame.fire_rate
	mag_size = mag.capacity
	reload_time = mag.reload_time
	spread = barrel.spread + optics.spread
	recoil = frame.recoil

func update_UI() -> void:
	dmg_label.text = str(damage)
	fire_rate_label.text = str(fire_rate)
	mag_size_label.text = str(mag_size)
	reload_time_label.text = str(reload_time)
	accuracy_label.text = str(spread)
	recoil_label.text = str(recoil)
	dps_label.text = "calculate this"
